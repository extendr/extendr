<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Make inherent implementations available to R"><title>extendr_impl in extendr_macros::extendr_impl - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-dd39b87e5fcfba68.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="extendr_macros" data-themes="" data-resource-suffix="" data-rustdoc-version="1.80.0-nightly (78a775127 2024-05-11)" data-channel="nightly" data-search-js="search-d52510db62a78183.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-118b08c4c78b968e.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc fn"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../extendr_macros/index.html">extendr_macros</a><span class="version">0.6.0</span></h2></div><div class="sidebar-elems"><h2><a href="index.html">In extendr_macros::extendr_impl</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Function <a href="../index.html">extendr_macros</a>::<wbr><a href="index.html">extendr_impl</a>::<wbr><a class="fn" href="#">extendr_impl</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/extendr_macros/extendr_impl.rs.html#108-323">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub fn extendr_impl(
    item_impl: <a class="struct" href="https://docs.rs/syn/2.0.63/syn/item/struct.ItemImpl.html" title="struct syn::item::ItemImpl">ItemImpl</a>,
    opts: &amp;<a class="struct" href="../wrappers/struct.ExtendrOptions.html" title="struct extendr_macros::wrappers::ExtendrOptions">ExtendrOptions</a>
) -&gt; <a class="type" href="https://docs.rs/syn/2.0.63/syn/error/type.Result.html" title="type syn::error::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/nightly/proc_macro/struct.TokenStream.html" title="struct proc_macro::TokenStream">TokenStream</a>&gt;</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Make inherent implementations available to R</p>
<p>The extendr_impl function is used to make inherent implementations
avaialble to R as an environment. By adding the [<code>extendr</code>] attribute
macro to an <code>impl</code> block (supported with <code>enum</code>s and <code>struct</code>s), the
methods in the impl block are made available as functions in an
environment.</p>
<p>On the R side, an environment with the same name of the inherent
implementation is created. The environment has functions within it
that correspond to each method in the impl block. Note that in order
for an impl block to be compatible with extendr (and thus R), its return
type must be able to be returned to R. For example, any struct that might
be returned must <em>also</em> have an <code>#[extendr]</code> annotated impl block.</p>
<p>Example:</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code><span class="kw">use </span>extendr_api::prelude::<span class="kw-2">*</span>;

<span class="comment">// a struct that will be used internal the People struct
</span><span class="attr">#[derive(Clone, Debug, IntoDataFrameRow)]
</span><span class="kw">struct </span>Person {
    name: String,
    age: i32,
}

<span class="comment">// This will collect people in the struct
</span><span class="attr">#[extendr]
#[derive(Clone, Debug)]
</span><span class="kw">struct </span>People(Vec&lt;Person&gt;);

<span class="attr">#[extendr]
</span><span class="doccomment">/// @export
</span><span class="kw">impl </span>People {

    <span class="comment">// instantiate a new struct with an empty vector
    </span><span class="kw">fn </span>new() -&gt; <span class="self">Self </span>{
        <span class="kw">let </span>vec: Vec&lt;Person&gt; = Vec::new();
        <span class="self">Self</span>(vec)
    }

    <span class="comment">// add a person to the internal vector
    </span><span class="kw">fn </span>add_person(<span class="kw-2">&amp;mut </span><span class="self">self</span>, name: <span class="kw-2">&amp;</span>str, age: i32) -&gt; <span class="kw-2">&amp;mut </span><span class="self">Self </span>{
        <span class="kw">let </span>person = Person {
            name: String::from(name),
            age: age,
        };

        <span class="self">self</span>.<span class="number">0</span>.push(person);

        <span class="comment">// return self
        </span><span class="self">self
    </span>}
     
    <span class="comment">// Convert the struct into a data.frame
    </span><span class="kw">fn </span>into_df(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; Robj {
        <span class="kw">let </span>df = <span class="self">self</span>.<span class="number">0</span>.clone().into_dataframe();

        <span class="kw">match </span>df {
            <span class="prelude-val">Ok</span>(df) =&gt; df.as_robj().clone(),
            <span class="prelude-val">Err</span>(<span class="kw">_</span>) =&gt; <span class="macro">data_frame!</span>(),
        }
    }

    <span class="comment">// add another `People` struct to self
    </span><span class="kw">fn </span>add_people(<span class="kw-2">&amp;mut </span><span class="self">self</span>, others: <span class="kw-2">&amp;</span>People) -&gt; <span class="kw-2">&amp;mut </span><span class="self">Self </span>{
        <span class="self">self</span>.<span class="number">0</span>.extend(others.<span class="number">0</span>.clone().into_iter());
        <span class="self">self
    </span>}

    <span class="comment">// create a function to print the self which can be called
    // from an R print method
    </span><span class="kw">fn </span>print_self(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; String {
        <span class="macro">format!</span>(<span class="string">"{:?}"</span>, <span class="self">self</span>.<span class="number">0</span>)
    }

}

<span class="comment">// Macro to generate exports.
// This ensures exported functions are registered with R.
// See corresponding C code in `entrypoint.c`.
</span><span class="macro">extendr_module!</span> {
    <span class="kw">mod </span>testself;
    <span class="kw">impl </span>People;
}</code></pre></div>
<p><strong>Known limitation</strong>: if you return <code>&amp;Self</code> or <code>&amp;mut Self</code> or a reference
to the same type, the resultant R object will <em>always</em> be the original
self. For example the below method <strong>will not</strong> return <code>other</code>.</p>

<div class="example-wrap ignore"><a href="#" class="tooltip" title="This example is not tested">ⓘ</a><pre class="rust rust-example-rendered"><code> <span class="comment">// This is not possible today
</span><span class="attr">#[extendr]
</span><span class="kw">impl </span>People {
  <span class="kw">fn </span>return_other(<span class="kw-2">&amp;</span><span class="self">self</span>, other: <span class="kw-2">&amp;</span><span class="lifetime">'static </span>T) -&gt; <span class="kw-2">&amp;</span><span class="self">Self </span>{
    other
  }
}</code></pre></div>
</div></details></section></div></main></body></html>